<!doctype html>
<html lang="lt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Savƒôs Sabota≈æo Testas</title>
  <meta name="description" content="10 klausim≈≥ testas tavo gynybinƒóms programoms atpa≈æinti." />
  <style>
    :root{
      --bg:#f8fafc;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e2e8f0;
      --soft:#f1f5f9;
      --indigo:#4f46e5;
      --indigo2:#4338ca;
      --black:#0b1220;
      --shadow: 0 20px 60px rgba(2,6,23,.12);
      --shadow2: 0 14px 40px rgba(2,6,23,.10);
      --radiusXL: 32px;
      --radiusXXL: 40px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg);
      color: var(--text);
    }
    .wrap{
      min-height:100svh;
      padding: 40px 16px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .container{
      width:100%;
      max-width: 760px;
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      box-shadow: var(--shadow);
      border-radius: var(--radiusXXL);
      overflow:hidden;
    }
    .p-12{ padding:48px; }
    .center{ text-align:center; }
    .title{
      font-size: 30px;
      letter-spacing:-.02em;
      margin: 0 0 12px 0;
      font-weight: 900;
    }
    .subtitle{
      margin:0 0 28px 0;
      color: var(--muted);
      font-size: 18px;
      line-height: 1.5;
    }
    .badgeIcon{
      width:64px; height:64px;
      border-radius: 18px;
      background: var(--indigo);
      display:flex;
      align-items:center;
      justify-content:center;
      margin: 0 auto 22px auto;
      box-shadow: 0 12px 30px rgba(79,70,229,.25);
      color:white;
      font-size: 28px;
      font-weight: 900;
    }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      width:100%;
      padding: 18px 18px;
      border-radius: 18px;
      border: 0;
      cursor:pointer;
      font-weight: 900;
      font-size: 18px;
      transition: .15s ease;
      user-select:none;
    }
    .btnPrimary{
      background: var(--black);
      color: white;
    }
    .btnPrimary:hover{ filter: brightness(1.06); }
    .btnIndigo{
      background: var(--indigo);
      color:#fff;
      box-shadow: 0 14px 32px rgba(79,70,229,.25);
    }
    .btnIndigo:hover{ background: var(--indigo2); }
    .btnGhost{
      background: transparent;
      color: var(--muted);
      padding: 12px 10px;
      font-size: 14px;
      font-weight: 800;
      width:auto;
    }
    .btnGhost:hover{ color: var(--text); }
    .btnGhost:disabled{
      color:#cbd5e1;
      cursor:not-allowed;
    }
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 0 8px 14px 8px;
    }
    .progress{
      width: 140px;
      height: 6px;
      background: #e2e8f0;
      border-radius: 999px;
      overflow:hidden;
    }
    .progress > div{
      height:100%;
      width:0%;
      background: #6366f1;
      transition: width .25s ease;
    }
    .qcard{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radiusXL);
      box-shadow: var(--shadow2);
      padding: 38px;
    }
    .qtitle{
      margin:0 0 22px 0;
      font-size: 22px;
      line-height: 1.35;
      font-weight: 900;
      letter-spacing: -.01em;
    }
    .options{
      display:flex;
      flex-direction:column;
      gap: 12px;
    }
    .opt{
      display:flex;
      align-items:flex-start;
      gap: 14px;
      width:100%;
      text-align:left;
      padding: 16px 16px;
      border-radius: 16px;
      border: 2px solid #f1f5f9;
      background: #fff;
      cursor:pointer;
      transition: .15s ease;
    }
    .opt:hover{
      border-color: rgba(79,70,229,.70);
      background: rgba(79,70,229,.06);
    }
    .dot{
      margin-top: 6px;
      width:8px; height:8px;
      border-radius:999px;
      background: rgba(99,102,241,.25);
      flex: 0 0 auto;
    }
    .opt span{
      color: #334155;
      font-weight: 800;
      line-height: 1.35;
    }
    .hidden{ display:none !important; }

    .resultHeader{
      background: var(--black);
      color:#fff;
      padding: 40px;
      text-align:center;
    }
    .kicker{
      font-size: 10px;
      letter-spacing: .22em;
      text-transform: uppercase;
      color: rgba(99,102,241,.85);
      font-weight: 900;
      margin: 0 0 8px 0;
    }
    .rTitle{
      font-size: 34px;
      letter-spacing:-.02em;
      font-weight: 950;
      margin: 0 0 8px 0;
    }
    .rSecondary{
      font-size: 12px;
      color: rgba(199,210,254,.95);
      margin:0;
      font-weight: 800;
    }
    .resultBody{ padding: 40px; }
    .quote{
      padding: 18px;
      background: rgba(79,70,229,.08);
      border: 1px solid rgba(79,70,229,.15);
      border-radius: 18px;
      text-align:center;
      font-style: italic;
      font-weight: 800;
      color: #0f172a;
      margin: 0 0 22px 0;
    }
    .box{
      padding: 18px;
      background: var(--soft);
      border-radius: 18px;
      margin-bottom: 12px;
    }
    .label{
      font-size: 10px;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: #94a3b8;
      font-weight: 900;
      margin:0 0 8px 0;
    }
    .box p{
      margin:0;
      color:#334155;
      font-size: 14px;
      line-height: 1.55;
    }
    .reflection{
      padding: 18px;
      background: #fff;
      border-radius: 18px;
      border: 1px solid rgba(79,70,229,.20);
      box-shadow: 0 8px 20px rgba(2,6,23,.06);
      margin-top: 12px;
    }
    .reflection .label{ color: rgba(99,102,241,.95); }
    .reflection p{
      margin:0;
      font-weight: 900;
      font-style: italic;
      color:#0f172a;
    }
    .sectionTitle{
      font-size: 12px;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: #94a3b8;
      font-weight: 900;
      margin: 22px 0 10px 8px;
    }
    .step{
      display:flex;
      gap: 14px;
      padding: 16px;
      background: #fff;
      border-radius: 18px;
      border: 1px solid #f1f5f9;
      margin-bottom: 10px;
    }
    .num{
      width:40px; height:40px;
      border-radius: 14px;
      background: var(--indigo);
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 950;
      flex: 0 0 auto;
    }
    .step h4{
      margin:0 0 4px 0;
      font-weight: 950;
      color:#0f172a;
      font-size: 14px;
    }
    .step p{
      margin:0;
      color:#64748b;
      font-size: 13px;
      line-height: 1.5;
      font-weight: 700;
    }
    .footerActions{
      border-top: 1px solid #f1f5f9;
      margin-top: 18px;
      padding-top: 18px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .copied{
      text-align:center;
      color: #059669;
      font-weight: 900;
      font-size: 12px;
      margin:0;
    }
    @media (max-width: 520px){
      .p-12{ padding: 34px; }
      .qcard{ padding: 26px; }
      .resultHeader{ padding: 28px; }
      .resultBody{ padding: 26px; }
      .rTitle{ font-size: 28px; }
      .title{ font-size: 26px; }
      .subtitle{ font-size: 16px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="container">

      <section id="screen-intro" class="card p-12 center">
        <div class="badgeIcon" aria-hidden="true">‚ö°</div>
        <h1 class="title">Atrask savo vidinƒØ sabota≈æƒÖ</h1>
        <p class="subtitle">10 klausim≈≥ testas tavo gynybinƒóms programoms atpa≈æinti.</p>
        <button id="btn-start" class="btn btnPrimary">Pradƒóti</button>
      </section>

      <section id="screen-test" class="hidden">
        <div class="topbar">
          <button id="btn-back" class="btnGhost" type="button">‚Üê Atgal</button>
          <div class="progress" aria-label="Progresas">
            <div id="progress-bar"></div>
          </div>
        </div>

        <div class="qcard">
          <h2 id="question-text" class="qtitle"></h2>
          <div id="options" class="options"></div>
        </div>
      </section>

      <section id="screen-result" class="card hidden">
        <div class="resultHeader">
          <p class="kicker">J≈´s≈≥ tipas</p>
          <h1 id="result-title" class="rTitle"></h1>
          <p id="result-secondary" class="rSecondary hidden"></p>
        </div>
        <div class="resultBody">
          <div id="result-quote" class="quote"></div>

          <div class="box">
            <p class="label">Kodƒól taip veikia</p>
            <p id="result-psychology"></p>
          </div>

          <div class="box">
            <p class="label">Kasdienis poveikis</p>
            <p id="result-impact"></p>
          </div>

          <div class="reflection">
            <p class="label">Refleksija</p>
            <p id="result-reflection"></p>
          </div>

          <div class="sectionTitle">Rekomendacijos</div>
          <div id="result-steps"></div>

          <div class="box" style="margin-top:14px;">
            <p class="label">Gauk platesnƒô analizƒô el. pa≈°tu</p>
            <p style="margin:0 0 10px 0; color:#334155; font-size:14px; line-height:1.55; font-weight:700;">
              ƒÆvesk el. pa≈°tƒÖ ir atsi≈≥siu i≈°samesnƒØ paai≈°kinimƒÖ bei kryptƒØ pagal tavo tipƒÖ.
            </p>

            <input id="email-input" type="email" placeholder="tavo@email.com"
              style="width:100%; padding:14px; border-radius:14px; border:1px solid #e2e8f0; font-weight:800; outline:none;" />

            <button id="btn-email" class="btn btnPrimary" type="button" style="margin-top:10px;">
              Gauti analizƒô el. pa≈°tu
            </button>

            <p id="email-msg" class="copied hidden" style="color:#0f172a; margin-top:10px;"></p>
          </div>

          <div class="footerActions">
            <button id="btn-share" class="btn btnIndigo" type="button">üîó Pasidalinti rezultatu</button>
            <p id="copied-msg" class="copied hidden">Nukopijuota! ‚úÖ</p>
            <button id="btn-restart" class="btnGhost" type="button">‚Üª Atlikti i≈° naujo</button>
          </div>
        </div>
      </section>

    </div>
  </div>

  <script>
    const ARCHETYPES = {
      PERFECTIONIST: {
        id: 'PERFECTIONIST',
        title: 'Perfekcionistas',
        description: 'J≈´s painiojate savo vertƒô su savo pasiekimais. Jums atrodo, kad klaida lygi asmeninei katastrofai.',
        psychology: 'J≈´s≈≥ pasƒÖmonƒó naudoja tobulumƒÖ kaip apsaugƒÖ nuo kritikos. Jei viskas bus idealu, niekas negalƒós j≈´s≈≥ u≈ægauti ar pasmerkti.',
        dailyImpact: 'Nuolatinis nuovargis, perdegimas ir sunkumas u≈æbaigti projektus, nes jie niekada neatrodo pakankamai geri.',
        steps: [
          { title: '80% taisyklƒó', text: 'SƒÖmoningai nusprƒôskite atlikti u≈æduotƒØ ‚Äûgerai‚Äú, o ne ‚Äûtobulai‚Äú.' },
          { title: 'Klaid≈≥ de-dramatizavimas', text: 'Klauskite savƒôs: ‚ÄûKas baisiausio nutiks po 5 met≈≥, jei ƒçia suklysiu?‚Äú' },
          { title: 'Proceso ≈°ventimas', text: 'Apdovanokite save u≈æ pastangas, o ne tik u≈æ rezultatƒÖ.' }
        ],
        reflection: 'Kuo a≈° b≈´ƒçiau, jei nebeturƒóƒçiau savo pasiekim≈≥?'
      },
      PROCRASTINATOR: {
        id: 'PROCRASTINATOR',
        title: 'Emocinis Atidƒóliotojas',
        description: 'Atidƒóliojimas jums yra b≈´das reguliuoti nemalonias emocijas ‚Äì baimƒô ar nesaugumƒÖ.',
        psychology: 'Tai gynyba nuo vertinimo. Jei nespƒójate dƒól laiko tr≈´kumo, galite teisintis laiku, o ne kompetencija.',
        dailyImpact: 'Chroni≈°kas streso jausmas, nei≈°naudotas potencialas ir ‚Äûpaskutinƒós minutƒós‚Äú panika.',
        steps: [
          { title: '5 minuƒçi≈≥ kontraktas', text: 'Pasi≈æadƒókite dirbti tik 5 minutes.' },
          { title: 'Emocij≈≥ ƒØvardijimas', text: 'Paklauskite savƒôs: ‚ÄûKokios emocijos dabar vengiu?‚Äú' },
          { title: 'Skaidymas', text: 'Skaidykite u≈æduotis ƒØ mikroskopinius etapus.' }
        ],
        reflection: 'Nuo ko a≈° bƒógu pasinerdamas ƒØ smulkmenas?'
      },
      CRITIC: {
        id: 'CRITIC',
        title: 'Vidinis Nuvertintojas',
        description: 'J≈´s esate savo did≈æiausias prie≈°as. J≈´s≈≥ pasiekimai jums atrodo lyg atsitiktinumai.',
        psychology: 'J≈´s nuvertinate save pirmas, kad kitiems likt≈≥ ma≈æiau erdvƒós jus nuvilti ar u≈ægauti.',
        dailyImpact: 'Sunkumas priimti komplimentus, Imposterio sindromas ir nuolatinƒó savikritika.',
        steps: [
          { title: 'Fakt≈≥ auditas', text: 'U≈æra≈°ykite 3 ƒØrodymus, kad j≈´s≈≥ sƒókmƒó nƒóra atsitiktinƒó.' },
          { title: 'Pagyrimo priƒómimas', text: 'Atsakykite tik ‚ÄûAƒçi≈´‚Äú be joki≈≥ papildom≈≥ paai≈°kinim≈≥.' },
          { title: 'Draugo balsas', text: 'Kalbƒókite su savimi taip, kaip su geriausiu draugu.' }
        ],
        reflection: 'Kieno balsu i≈° ties≈≥ kalba mano vidinis kritikas?'
      },
      PLEASER: {
        id: 'PLEASER',
        title: 'Santyki≈≥ Gelbƒótojas',
        description: 'J≈´s≈≥ vertƒó priklauso nuo kit≈≥ pritarimo. Sabota≈æuojate save pildydami svetimus l≈´kesƒçius.',
        psychology: 'Meilƒô matote kaip u≈æsitarnaujamƒÖ valiutƒÖ. Bijote konflikt≈≥, nes jie asocijuojasi su visi≈°ku atst≈´mimu.',
        dailyImpact: 'Vidinis pyktis, savo poreiki≈≥ ignoravimas ir emocinis i≈°sekimas.',
        steps: [
          { title: 'Pauzƒós praktika', text: 'Sakykite: ‚ÄûMan reikia pagalvoti‚Äú, u≈æuot i≈°kart sutikƒô.' },
          { title: 'Ma≈æos ribos', text: 'I≈°mokite pasakyti ‚Äûne‚Äú bent vienam pra≈°ymui per dienƒÖ.' },
          { title: 'Ryto rutina', text: 'RytƒÖ pradƒókite nuo u≈æduoties SAU, o ne kitiems.' }
        ],
        reflection: 'KƒÖ a≈° daryƒçiau, jei man neber≈´pƒót≈≥ kit≈≥ nuomonƒó?'
      }
    };

    const QUESTIONS = [
      { id: 1, text: "Kaip reaguojate ƒØ nuo≈°ird≈≥ pagyrimƒÖ u≈æ darbƒÖ?", options: [
        { text: "I≈°kart jƒØ nuvertinu (pvz., ‚Äûtiesiog pasisekƒó‚Äú).", type: 'CRITIC' },
        { text: "Galvoju: ‚ÄûMalonu, bet jie nematƒó mano klaid≈≥‚Äú.", type: 'PERFECTIONIST' },
        { text: "Jauƒçiuosi lyg b≈´ƒçiau juos apgavƒôs (Imposterio sindromas).", type: 'CRITIC' },
        { text: "D≈æiaugiuosi, nes tai rei≈°kia, kad esu reikalingas.", type: 'PLEASER' },
        { text: "Jauƒçiu spaudimƒÖ kitƒÖ kartƒÖ padaryti dar geriau.", type: 'PROCRASTINATOR' }
      ]},
      { id: 2, text: "KƒÖ darote prie≈° pradedant sunk≈≥ projektƒÖ?", options: [
        { text: "Ruo≈°iuosi am≈æinai, nes bijau nepadaryti tobulai.", type: 'PERFECTIONIST' },
        { text: "U≈æsiimu smulkmenomis, kad tik nereikƒót≈≥ pradƒóti pagrindinio darbo.", type: 'PROCRASTINATOR' },
        { text: "I≈°kart randu de≈°imt prie≈æasƒçi≈≥, kodƒól nepavyks.", type: 'CRITIC' },
        { text: "Klausiu kit≈≥ nuomonƒós, kad pasijusƒçiau saugiau.", type: 'PLEASER' }
      ]},
      { id: 3, text: "J≈´s≈≥ reakcija ƒØ nedidelƒô klaidƒÖ:", options: [
        { text: "Grau≈æiu save kelias dienas.", type: 'PERFECTIONIST' },
        { text: "Manau, kad tai ƒØrodo mano nesugebƒójimƒÖ.", type: 'CRITIC' },
        { text: "Apsimetu, kad nieko neƒØvyko, ir u≈æsiimu kuo kitu.", type: 'PROCRASTINATOR' },
        { text: "Atsipra≈°inƒóju vis≈≥, net jei klaida niekam nepakenkƒó.", type: 'PLEASER' }
      ]},
      { id: 4, text: "Kaip jauƒçiatƒós sakydami ‚Äûne‚Äú?", options: [
        { text: "Sutinku, nors viduje pykstu, nes bijau nuvilti.", type: 'PLEASER' },
        { text: "Pasakau ‚Äûne‚Äú, bet po to visƒÖ laikƒÖ save grau≈æiu.", type: 'CRITIC' },
        { text: "Vengiu atsakymo iki paskutinƒós akimirkos.", type: 'PROCRASTINATOR' },
        { text: "Sutinku, nes manau, kad privalau viskƒÖ suspƒóti idealiai.", type: 'PERFECTIONIST' }
      ]},
      { id: 5, text: "Laisvas laikas be ƒØsipareigojim≈≥ jums sukelia:", options: [
        { text: "Kaltƒós jausmƒÖ, kad nesu produktyvus.", type: 'PERFECTIONIST' },
        { text: "PasimetimƒÖ ‚Äì ne≈æinau, ko noriu a≈° pats.", type: 'PLEASER' },
        { text: "NorƒÖ ‚Äûbukai‚Äú nar≈°yti internete, kad nereikƒót≈≥ galvoti.", type: 'PROCRASTINATOR' },
        { text: "Mintis apie tai, kiek laiko jau esu i≈°≈°vaistƒôs.", type: 'CRITIC' }
      ]},
      { id: 6, text: "Matydami svetimƒÖ sƒókmƒô, j≈´s:", options: [
        { text: "I≈°kart lyginu save su jais ir jauƒçiuosi prastesnis.", type: 'CRITIC' },
        { text: "Analizuoju j≈≥ klaidas, kad pasijusƒçiau ‚Äûtobulesnis‚Äú.", type: 'PERFECTIONIST' },
        { text: "Jauƒçiuosi kaltas, kad a≈° vis dar nieko nepasiekiau.", type: 'PROCRASTINATOR' },
        { text: "Galvoju, kaip galƒóƒçiau jiems pasitarnauti.", type: 'PLEASER' }
      ]},
      { id: 7, text: "Kaip priimate konstruktyviƒÖ kritikƒÖ?", options: [
        { text: "Ginuosi, nes kritika man rei≈°kia, kad esu ‚Äûblogas‚Äú.", type: 'PERFECTIONIST' },
        { text: "Sutinku, nes giliai viduje manau, kad esu nieko vertas.", type: 'CRITIC' },
        { text: "Ignoruoju, nes tai kelia per didelƒØ stresƒÖ.", type: 'PROCRASTINATOR' },
        { text: "Labai susisieloju ir bandau ‚Äûi≈°taisyti‚Äú kit≈≥ nuomonƒô.", type: 'PLEASER' }
      ]},
      { id: 8, text: "Kai esate pervargƒôs, bet darbai nelaukia:", options: [
        { text: "Dirbu per jƒógƒÖ, nes rezultatas privalo b≈´ti idealus.", type: 'PERFECTIONIST' },
        { text: "Nusprend≈æiu ‚Äûpailsƒóti‚Äú 5 minutes, kurios virsta 3 valandomis.", type: 'PROCRASTINATOR' },
        { text: "Dirbu pykdamas ant savƒôs, koks esu lƒótas.", type: 'CRITIC' },
        { text: "Dirbu, nes negaliu nuvilti t≈≥, kurie laukia.", type: 'PLEASER' }
      ]},
      { id: 9, text: "Svarbus sprendimas gyvenime:", options: [
        { text: "Laukiu ‚Äûtinkamo‚Äú momento, kuris niekada neateina.", type: 'PROCRASTINATOR' },
        { text: "Ie≈°kau tobulo varianto, kol visai nebegaliu nusprƒôsti.", type: 'PERFECTIONIST' },
        { text: "Leid≈æiu kitiems nusprƒôsti u≈æ mane.", type: 'PLEASER' },
        { text: "Bijau, kad bet koks pasirinkimas bus klaidingas.", type: 'CRITIC' }
      ]},
      { id: 10, text: "Koks j≈´s≈≥ po≈æi≈´ris ƒØ ateities tikslus?", options: [
        { text: "Privalau pasiekti auk≈°tum≈≥, kitaip mano gyvenimas bevertis.", type: 'PERFECTIONIST' },
        { text: "Ateitis baugina, geriau apie jƒÖ per daug negalvoti.", type: 'PROCRASTINATOR' },
        { text: "Nemanau, kad esu vertas ka≈æko ypatingo.", type: 'CRITIC' },
        { text: "Tikiuosi, kad mano sƒókmƒó padƒós kitiems mane labiau mylƒóti.", type: 'PLEASER' }
      ]}
    ];

    let currentQuestionIndex = 0;
    let scores = { PERFECTIONIST: 0, PROCRASTINATOR: 0, CRITIC: 0, PLEASER: 0 };
    let answerHistory = [];
    let copyMsgTimer = null;

    const screenIntro  = document.getElementById('screen-intro');
    const screenTest   = document.getElementById('screen-test');
    const screenResult = document.getElementById('screen-result');

    const btnStart   = document.getElementById('btn-start');
    const btnBack    = document.getElementById('btn-back');
    const progressBar= document.getElementById('progress-bar');

    const qText   = document.getElementById('question-text');
    const options = document.getElementById('options');

    const rTitle      = document.getElementById('result-title');
    const rSecondary  = document.getElementById('result-secondary');
    const rQuote      = document.getElementById('result-quote');
    const rPsychology = document.getElementById('result-psychology');
    const rImpact     = document.getElementById('result-impact');
    const rReflection = document.getElementById('result-reflection');
    const rSteps      = document.getElementById('result-steps');

    const btnShare   = document.getElementById('btn-share');
    const btnRestart = document.getElementById('btn-restart');
    const copiedMsg  = document.getElementById('copied-msg');

    const emailInput = document.getElementById('email-input');
    const btnEmail = document.getElementById('btn-email');
    const emailMsg = document.getElementById('email-msg');

    function setEmailMsg(text, ok=true){
      emailMsg.textContent = text;
      emailMsg.classList.remove('hidden');
      emailMsg.style.color = ok ? '#059669' : 'crimson';
    }

    function showScreen(name){
      screenIntro.classList.toggle('hidden', name !== 'intro');
      screenTest.classList.toggle('hidden', name !== 'test');
      screenResult.classList.toggle('hidden', name !== 'result');
    }

    function resetGame(){
      currentQuestionIndex = 0;
      scores = { PERFECTIONIST: 0, PROCRASTINATOR: 0, CRITIC: 0, PLEASER: 0 };
      answerHistory = [];
      if(emailInput) emailInput.value = '';
      if(emailMsg) emailMsg.classList.add('hidden');
      renderQuestion();
      updateBackButton();
    }

    function updateBackButton(){
      btnBack.disabled = currentQuestionIndex === 0;
    }

    function setProgress(){
      const pct = ((currentQuestionIndex + 1) / QUESTIONS.length) * 100;
      progressBar.style.width = pct + '%';
    }

    function renderQuestion(){
      const q = QUESTIONS[currentQuestionIndex];
      qText.textContent = q.text;

      options.innerHTML = '';
      q.options.forEach((opt) => {
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'opt';
        b.innerHTML = '<div class="dot"></div><span></span>';
        b.querySelector('span').textContent = opt.text;
        b.addEventListener('click', () => handleAnswer(opt.type));
        options.appendChild(b);
      });

      setProgress();
      updateBackButton();
    }

    function handleAnswer(type){
      scores[type] += 1;
      answerHistory.push(type);

      if(currentQuestionIndex < QUESTIONS.length - 1){
        currentQuestionIndex += 1;
        renderQuestion();
      } else {
        showResults();
      }
    }

    function handleBack(){
      if(currentQuestionIndex <= 0) return;
      const lastType = answerHistory.pop();
      if(lastType) scores[lastType] -= 1;
      currentQuestionIndex -= 1;
      renderQuestion();
    }

    function getTopTypes(){
      const sorted = Object.entries(scores).sort((a,b) => b[1] - a[1]);
      const primary = sorted[0][0];
      const primaryScore = sorted[0][1];
      const second = sorted[1][0];
      const secondScore = sorted[1][1];
      const secondary = (secondScore > 0 && secondScore >= primaryScore - 1) ? second : null;
      return { primary, secondary };
    }

    function showResults(){
      const { primary, secondary } = getTopTypes();
      const res = ARCHETYPES[primary];
      const res2 = secondary ? ARCHETYPES[secondary] : null;

      rTitle.textContent = res.title;

      if(res2){
        rSecondary.textContent = 'Taip pat pasirei≈°kia: ' + res2.title;
        rSecondary.classList.remove('hidden');
      } else {
        rSecondary.classList.add('hidden');
      }

      rQuote.textContent = '"' + res.description + '"';
      rPsychology.textContent = res.psychology;
      rImpact.textContent = res.dailyImpact;
      rReflection.textContent = '‚Äû' + res.reflection + '‚Äú';

      rSteps.innerHTML = '';
      res.steps.forEach((s, i) => {
        const row = document.createElement('div');
        row.className = 'step';
        row.innerHTML = '<div class="num"></div><div><h4></h4><p></p></div>';
        row.querySelector('.num').textContent = String(i+1);
        row.querySelector('h4').textContent = s.title;
        row.querySelector('p').textContent = s.text;
        rSteps.appendChild(row);
      });

      copiedMsg.classList.add('hidden');
      showScreen('result');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    async function copyToClipboard(text){
      try{
        if(navigator.clipboard && navigator.clipboard.writeText){
          await navigator.clipboard.writeText(text);
        } else {
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.setAttribute('readonly','');
          ta.style.position = 'absolute';
          ta.style.left = '-9999px';
          document.body.appendChild(ta);
          ta.select();
          document.execCommand('copy');
          document.body.removeChild(ta);
        }
        copiedMsg.classList.remove('hidden');
        clearTimeout(copyMsgTimer);
        copyMsgTimer = setTimeout(() => copiedMsg.classList.add('hidden'), 2000);
      } catch(e){
        console.error('Klaida kopijuojant', e);
      }
    }

    async function shareResults(){
      const { primary } = getTopTypes();
      const res = ARCHETYPES[primary];
      const text = 'Atlikau Savƒôs Sabota≈æo TestƒÖ! Mano tipas: ' + res.title + '. Su≈æinok savo modelƒØ ir tu!';
      const url = window.location.href;

      if(navigator.share){
        try{
          await navigator.share({ title: 'Savƒôs Sabota≈æo Testas', text, url });
          return;
        } catch(e){}
      }
      await copyToClipboard(text);
    }

    async function submitEmail(){
      const email = (emailInput?.value || '').trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if(!emailRegex.test(email)){
        setEmailMsg('ƒÆvesk teisingƒÖ el. pa≈°tƒÖ.', false);
        return;
      }

      const { primary } = getTopTypes();

      btnEmail.disabled = true;
      btnEmail.textContent = 'Siunƒçiu‚Ä¶';

      try{
        const resp = await fetch('/api/subscribe', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, archetype: primary })
        });
        const data = await resp.json();
        if(!resp.ok || !data.ok){
          setEmailMsg('Nepavyko. Patikrink nustatymus arba bandyk dar kartƒÖ.', false);
        } else {
          setEmailMsg('Si≈≥sta! Patikrink el. pa≈°tƒÖ (ir Spam/Promotions).', true);
        }
      } catch(e){
        setEmailMsg('Techninƒó klaida. Bandyk dar kartƒÖ.', false);
      } finally {
        btnEmail.disabled = false;
        btnEmail.textContent = 'Gauti analizƒô el. pa≈°tu';
      }
    }

    btnStart.addEventListener('click', () => { resetGame(); showScreen('test'); });
    btnBack.addEventListener('click', handleBack);
    btnRestart.addEventListener('click', () => { resetGame(); showScreen('test'); });
    btnShare.addEventListener('click', shareResults);
    btnEmail.addEventListener('click', submitEmail);

    showScreen('intro');
  </script>
</body>
</html>
